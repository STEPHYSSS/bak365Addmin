"use strict";var CompressionWebpackPlugin,BundleAnalyzerPlugin,path=require("path"),utils=require("./utils"),webpack=require("webpack"),config=require("../config"),merge=require("webpack-merge"),baseWebpackConfig=require("./webpack.base.conf"),CopyWebpackPlugin=require("copy-webpack-plugin"),HtmlWebpackPlugin=require("html-webpack-plugin"),ExtractTextPlugin=require("extract-text-webpack-plugin"),OptimizeCSSPlugin=require("optimize-css-assets-webpack-plugin"),UglifyJsPlugin=require("uglifyjs-webpack-plugin"),env="testing"===process.env.NODE_ENV?require("../config/test.env"):require("../config/prod.env"),webpackConfig=merge(baseWebpackConfig,{module:{rules:utils.styleLoaders({sourceMap:config.build.productionSourceMap,extract:!0,usePostCSS:!0})},devtool:!!config.build.productionSourceMap&&config.build.devtool,output:{path:config.build.assetsRoot,filename:utils.assetsPath("js/[name].[chunkhash].js"),chunkFilename:utils.assetsPath("js/[id].[chunkhash].js")},plugins:[new webpack.DefinePlugin({"process.env":env}),new webpack.DefinePlugin({"process.env.BASE_URL":JSON.stringify(process.env.BASE_URL)}),new UglifyJsPlugin({uglifyOptions:{compress:{warnings:!1}},sourceMap:config.build.productionSourceMap,parallel:!0}),new ExtractTextPlugin({filename:utils.assetsPath("css/[name].[contenthash].css"),allChunks:!0}),new HtmlWebpackPlugin({filename:"testing"===process.env.NODE_ENV?"index.html":config.build.index,template:"index.html",inject:!0,minify:{removeComments:!0,collapseWhitespace:!0,removeAttributeQuotes:!0},chunksSortMode:"dependency"}),new webpack.HashedModuleIdsPlugin,new webpack.optimize.ModuleConcatenationPlugin,new webpack.optimize.CommonsChunkPlugin({name:"vendor",minChunks:function(e){return e.resource&&/\.js$/.test(e.resource)&&0===e.resource.indexOf(path.join(__dirname,"../node_modules"))}}),new webpack.optimize.CommonsChunkPlugin({name:"manifest",minChunks:1/0}),new webpack.optimize.CommonsChunkPlugin({name:"app",async:"vendor-async",children:!0,minChunks:3}),new CopyWebpackPlugin([{from:path.resolve(__dirname,"../static"),to:config.build.assetsSubDirectory,ignore:[".*"]}])]});config.build.productionGzip&&(CompressionWebpackPlugin=require("compression-webpack-plugin"),webpackConfig.plugins.push(new CompressionWebpackPlugin({asset:"[path].gz[query]",algorithm:"gzip",test:new RegExp("\\.("+config.build.productionGzipExtensions.join("|")+")$"),threshold:10240,minRatio:.8}))),config.build.bundleAnalyzerReport&&(BundleAnalyzerPlugin=require("webpack-bundle-analyzer").BundleAnalyzerPlugin,webpackConfig.plugins.push(new BundleAnalyzerPlugin)),module.exports=webpackConfig;
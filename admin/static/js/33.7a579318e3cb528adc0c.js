webpackJsonp([33],{"SA7/":function(e,t){},oB44:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("Xxa5"),i=r.n(o),l=r("//Fk"),a=r.n(l),s=r("exGp"),n=r.n(s),c=r("Ua8o"),u=r("R2SV"),m=r("T+sA"),h=r("ysSL"),p=r("7Zmj"),d=r("nkvz"),f=r("Cn51"),g=r("QvYb"),v=r("M4fF"),k=r.n(v),y=(r("G9QH"),{name:"",components:{goodType:h.a,Goods:p.a,imgLoad:d.a,ueditor1:f.a},data:function(){return{ruleForm:{DeliveryType:["2","1"],PayType:["1","2"],State:"1",SalePrice:0},rules:{ProdNo:[g.d(this)],Name:[g.b(this)],Score:[{required:!0,message:"请输入积分",trigger:"blur"}],StoreQty:[g.g(this)],ShopInfo:[g.f(this)],CateSID:[g.a(this)],DeliveryType:[{required:!0,message:"请选择配送方式",trigger:"change"}],PayType:[{required:!0,message:"请选择支付方式",trigger:"change"}]},loading:!1,goodsShow:!1,goodsNormsIndex:0,fileListUpMain:[],fileListUpList:[],integralStateList:u.f,showCheckTicket:!1,checkClick:[],checkList:[],allCheckList:[],storeList:[],disabledTakeout:!1,disabledLogistics:!0,FeaturesShow:!0,isIndeterminate:!0,checkAll:!1}},created:function(){this.getInfo()},methods:{getInfo:function(){var e=this;return n()(i.a.mark(function t(){var r,o,l,s,n,u;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,r=e.$route.query.SID?Object(m.a)({Action:"GetProdInfo",SID:e.$route.query.SID},"MIntegralOpera"):[],t.next=5,a.a.all([r,Object(m.a)({Action:"GetShopList"},"MShopOpera")]);case 5:o=t.sent,e.storeList=o[1].Data.ShopInfoList,e.loading=!1,e.$route.query.SID&&(e.ruleForm=o[0].Data.ProdInfo,e.ruleForm.CateSID=e.ruleForm.CateSID?e.ruleForm.CateSID.split(","):e.ruleForm.CateSID,e.$refs.goodType.value=e.ruleForm.CateSID,e.ruleForm.PayType=e.ruleForm.PayType?e.ruleForm.PayType.split(","):[],e.ruleForm.ActivityDate=e.ruleForm.ActivityDate?e.ruleForm.ActivityDate.split(","):[],e.ruleForm.DeliveryType=e.ruleForm.DeliveryType?e.ruleForm.DeliveryType.split(","):[],l=e.ruleForm.ShopInfo?e.ruleForm.ShopInfo.split(","):[],s=[],l.forEach(function(t){s.push(k.a.find(e.storeList,{SID:t}))}),0===s.length?e.ruleForm.PickShopName="全部门店":(n=F(s,"Name","SID"),e.ruleForm.PickShopName=n.nameArr.join(",")),u=(u=$.base64.atob(e.ruleForm.Features,"utf8")).replace(/src="Files/g,'src="../Files'),setTimeout(function(){e.$refs.Features.setUEContent(u)},300)),t.next=13;break;case 11:t.prev=11,t.t0=t.catch(0);case 13:e.fileListUpMain=e.ruleForm.Img?Object(c.d)(e.ruleForm.Img):[],e.fileListUpList=e.ruleForm.ImgList?Object(c.d)(e.ruleForm.ImgList):[];case 15:case"end":return t.stop()}},t,e,[[0,11]])}))()},changeGoodType:function(e){this.ruleForm.CateSID=e},selectGoods:function(e){this.goodsShow=!0,this.goodsNormsIndex=e},changeDig:function(e){this.goodsShow=e},sureGood:function(e){this.goodsShow=!1,null===this.goodsNormsIndex?(this.ruleForm.ProdNo=e.ProdNo,this.ruleForm.Name=e.ProdName):this.ruleForm.SpecList[this.goodsNormsIndex].ProdNo=e.ProdNo},upLoadImgsMain:function(e){e.length>0?this.ruleForm.Img=e[0].url:this.ruleForm.Img=""},upLoadImgsList:function(e){var t=[];e.forEach(function(e){t.push(e.url)}),this.ruleForm.ImgList=t.join(",")},PickShopFun:function(){var e=this;this.showCheckTicket=!0,this.checkList=this.storeList,this.allCheckList=[],this.checkList.forEach(function(t){e.allCheckList.push(t.SID)}),this.ruleForm.ShopInfo&&(this.checkClick=this.ruleForm.ShopInfo.split(","),this.handleCheckedCitiesChange(this.checkClick)),Object(c.e)(".el-dialog__body")},CheckTicketFun:function(){var e=this,t=[];this.checkClick.forEach(function(r){t.push(k.a.find(e.checkList,{SID:r}))});var r=F(t,"Name","SID"),o=r.nameArr;r.idArr;this.ruleForm.PickShopName=o.join(","),this.ruleForm.ShopInfo=this.checkClick.join(","),this.showCheckTicket=!1},beforeClose:function(e){e()},changeCheckbox:function(e){e.indexOf("3")>-1?this.disabledTakeout=!0:e.indexOf("2")>-1?this.disabledLogistics=!0:(this.disabledTakeout=!1,this.disabledLogistics=!1)},cancelFun:function(){this.$router.push("/weChat/manager/integral/goodSetting")},preserveFun:function(){var e,t=this;this.$refs.ruleForm.validate((e=n()(i.a.mark(function e(r){var o,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}return e.abrupt("return",!1);case 4:if(e.prev=4,o=k.a.cloneDeep(t.ruleForm),t.checkClick.length===t.checkList.length?o.ShopInfo="":o.ShopInfo=S(o.ShopInfo),o.Img){e.next=12;break}return t.$message.info("请添加主商品图片"),e.abrupt("return");case 12:o.Img=Object(c.f)(o,"Img");case 13:return o.ImgList&&(o.ImgList=Object(c.f)(o,"ImgList")),l=(l=t.$refs.Features.getUEContent()).replace(/src="\.\.\/Files/g,'src="Files'),o.Features=$.base64.btoa(l,"utf8"),o.ActivityDate&&(o.ActivityDate=S(o.ActivityDate)),o.CateSID=S(o.CateSID),o.DeliveryType=S(o.DeliveryType),o.PayType=S(o.PayType),o.Action="SetProdInfo",e.next=24,Object(m.a)(o,"MIntegralOpera");case 24:t.$message.success("操作成功"),setTimeout(function(){t.$router.push("/weChat/manager/integral/goodSetting")},300),e.next=31;break;case 28:e.prev=28,e.t0=e.catch(4),t.$message.error(e.t0);case 31:case"end":return e.stop()}},e,t,[[4,28]])})),function(t){return e.apply(this,arguments)}))},setInputDec:function(e,t){e&&(this.ruleForm[t]=e.toString().split(".")[0])},handleCheckAllChange:function(e){this.checkClick=e?this.allCheckList:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e){var t=e.length;this.checkAll=t===this.allCheckList.length,this.isIndeterminate=t>0&&t<this.allCheckList.length}}});function F(e,t,r){var o=e,i=[],l=[];return o.length>0&&o.forEach(function(e){i.push(e[t]),l.push(e[r])}),{nameArr:i,idArr:l}}function S(e){return"string"!=typeof e&&e?e.join(","):e}var b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"addEditIntegral"},[e._v("\n  基本信息\n  "),r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"150px"}},[r("el-form-item",{attrs:{label:"类别",prop:"CateSID"}},[r("goodType",{ref:"goodType",attrs:{isIntegral:!0},on:{changeGoodType:e.changeGoodType}})],1),e._v(" "),r("el-form-item",{key:1,attrs:{label:"商品编号",prop:"ProdNo"}},[r("el-input",{attrs:{readonly:!0,placeholder:"请填写商品编号"},model:{value:e.ruleForm.ProdNo,callback:function(t){e.$set(e.ruleForm,"ProdNo",t)},expression:"ruleForm.ProdNo"}}),e._v(" "),this.$route.query.SID?e._e():r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.selectGoods(null)}}},[e._v("...")])],1),e._v(" "),r("el-form-item",{attrs:{label:"商品名称",prop:"Name"}},[r("el-input",{attrs:{placeholder:"请填写商品名称"},model:{value:e.ruleForm.Name,callback:function(t){e.$set(e.ruleForm,"Name",t)},expression:"ruleForm.Name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"活动日期",prop:"ActivityDate"}},[r("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.ruleForm.ActivityDate,callback:function(t){e.$set(e.ruleForm,"ActivityDate",t)},expression:"ruleForm.ActivityDate"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"主积分商品图片",prop:"Img"}},[r("imgLoad",{attrs:{folder:"ProdImg",isAutoFixed:!0,fileListUp:e.fileListUpMain,limit:1},on:{upLoadImgs:e.upLoadImgsMain}}),e._v("(建议尺寸:800*800;大小:小于500kb;格式:JPG,PNG,JPEG)\n    ")],1),e._v(" "),r("el-form-item",{attrs:{label:"积分商品图片",prop:"ImgList"}},[r("imgLoad",{attrs:{folder:"integralProdImg",isAutoFixed:!0,fileListUp:e.fileListUpList},on:{upLoadImgs:e.upLoadImgsList}}),e._v("(建议尺寸:800*800;大小:小于500kb;格式:JPG,PNG,JPEG)\n    ")],1),e._v(" "),r("el-form-item",{attrs:{label:"商品售价",prop:"SalePrice"}},[e._v("\n      ¥\n      "),r("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.ruleForm.SalePrice,callback:function(t){e.$set(e.ruleForm,"SalePrice",t)},expression:"ruleForm.SalePrice"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"积分",prop:"Score"}},[e._v("\n      ¥\n      "),r("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.ruleForm.Score,callback:function(t){e.$set(e.ruleForm,"Score",t)},expression:"ruleForm.Score"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"库存",prop:"StoreQty"}},[e._v("\n      ¥\n      "),r("el-input-number",{attrs:{step:1,"controls-position":"right",min:0},on:{change:function(t){return e.setInputDec(e.ruleForm.StoreQty,"StoreQty")}},model:{value:e.ruleForm.StoreQty,callback:function(t){e.$set(e.ruleForm,"StoreQty",t)},expression:"ruleForm.StoreQty"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"状态",prop:"State"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.State,callback:function(t){e.$set(e.ruleForm,"State",t)},expression:"ruleForm.State"}},e._l(e.integralStateList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"供货门店"}},[r("el-input",{attrs:{readonly:"",placeholder:"请选择门店"},model:{value:e.ruleForm.PickShopName,callback:function(t){e.$set(e.ruleForm,"PickShopName",t)},expression:"ruleForm.PickShopName"}}),e._v(" "),r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"medium"},on:{click:e.PickShopFun}},[e._v("...")])],1),e._v(" "),r("el-form-item",{attrs:{label:"配送方式",prop:"DeliveryType"}},[r("el-checkbox-group",{on:{change:e.changeCheckbox},model:{value:e.ruleForm.DeliveryType,callback:function(t){e.$set(e.ruleForm,"DeliveryType",t)},expression:"ruleForm.DeliveryType"}},[r("el-checkbox",{attrs:{label:"1"}},[e._v("门店自取")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"支付方式",prop:"PayType"}},[r("el-checkbox-group",{model:{value:e.ruleForm.PayType,callback:function(t){e.$set(e.ruleForm,"PayType",t)},expression:"ruleForm.PayType"}},[r("el-checkbox",{attrs:{label:"2"}},[e._v("微信支付")]),e._v(" "),r("el-checkbox",{attrs:{label:"1"}},[e._v("微卡支付")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"推荐理由",prop:"Recommend"}},[r("el-input",{staticStyle:{width:"300px"},attrs:{type:"textarea",rows:3,placeholder:"最长支持200个字符",maxlength:"200"},model:{value:e.ruleForm.Recommend,callback:function(t){e.$set(e.ruleForm,"Recommend",t)},expression:"ruleForm.Recommend"}})],1),e._v(" "),r("el-form-item",{staticClass:"FeaturesStyle",attrs:{label:"产品特色",prop:"Features"}},[!1===e.FeaturesShow?r("el-button",{attrs:{type:"text"},on:{click:function(t){e.FeaturesShow=!0}}},[e._v("+编辑")]):e._e(),e._v(" "),e.FeaturesShow?r("ueditor1",{ref:"Features"}):e._e(),e._v(" "),!0===e.FeaturesShow?r("el-button",{attrs:{type:"text"},on:{click:function(t){e.FeaturesShow=!1}}},[e._v("隐藏")]):e._e()],1)],1),e._v(" "),r("Goods",{attrs:{goodsShow:e.goodsShow},on:{changeDig:e.changeDig,sureGood:e.sureGood}}),e._v(" "),r("el-dialog",{staticClass:"areaTree TicketDialog",attrs:{title:"选择门店",width:"600px","before-close":e.beforeClose,visible:e.showCheckTicket},on:{"update:visible":function(t){e.showCheckTicket=t}}},[r("div",{staticClass:"addScroll"},[r("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),r("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.checkClick,callback:function(t){e.checkClick=t},expression:"checkClick"}},e._l(e.checkList,function(t){return r("el-checkbox",{key:t.SID,attrs:{label:t.SID}},[e._v(e._s(t.Name))])}),1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showCheckTicket=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.CheckTicketFun}},[e._v("确 定")])],1)]),e._v(" "),r("div",{staticClass:"preserveStyle"},[r("el-button",{on:{click:e.cancelFun}},[e._v("取消")]),e._v(" "),r("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:e.preserveFun}},[e._v("保存")])],1)],1)},staticRenderFns:[]};var I=r("VU/8")(y,b,!1,function(e){r("SA7/")},null,null);t.default=I.exports}});
//# sourceMappingURL=33.7a579318e3cb528adc0c.js.map
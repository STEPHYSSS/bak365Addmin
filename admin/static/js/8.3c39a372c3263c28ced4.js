webpackJsonp([8],{"2JAD":function(e,t){},AoqP:function(e,t,a){"use strict";var r=a("mvHQ"),o=a.n(r),n=a("woOf"),i=a.n(n),s=a("Xxa5"),l=a.n(s),c=a("exGp"),u=a.n(c),p=a("//Fk"),m=a.n(p),d=a("2uFj");var f=a("T+sA"),h={name:"",props:{rangeList:Array,isStore:{type:Boolean,default:!1}},data:function(){return{map:"",marker:"",locationC:{latitude:39.916527,longitude:116.397128},polygonList:[],color:[],path:[],form:{latitude:"",longitude:""},paramsForm:{},objParams:{paramsFormList:[]},rules:{Name:[{required:!0,message:"请输入",trigger:"blur"}]},loadingBtn:!1,storeList:[]}},components:{},created:function(){var e=this;return u()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isStore){t.next=3;break}return t.next=3,e.getStoreList();case 3:return t.next=5,new m.a(function(e,t){window.init=function(){e(qq)};var a=document.createElement("script");a.type="text/javascript",a.src="http://map.qq.com/api/js?v=2.exp&callback=init&key="+d.b,a.onerror=t,document.head.appendChild(a)}).then(function(t){var a=new t.maps.LatLng(39.982163,116.30607),r={draggable:!0,scrollwheel:!0,zoom:13,center:a,mapTypeId:t.maps.MapTypeId.ROADMAP},o=new t.maps.Map(document.getElementById("container"),r);e.map=o;var n=e,i=new t.maps.Point(22,44),s=new t.maps.Size(44,44),l=new t.maps.Point(0,0),c=new t.maps.MarkerImage("static/img/activeIcon.png",s,l,i);e.Marker=t.maps.Marker;var u=new e.Marker({position:a,map:n.map});if(e.marker=u,u.setIcon(c),u.setDraggable(!0),e.Event=t.maps.event,e.Event.addListener(u,"dragend",function(e){var t={latitude:e.latLng.getLat(),longitude:e.latLng.getLng()};n.locationC={latitude:e.latLng.getLat(),longitude:e.latLng.getLng()},n.$emit("dragendArea",t)}),e.markers=new t.maps.MVCArray,e.MarkerCluster=t.maps.MarkerCluster,e.LatLng=t.maps.LatLng,e.MarkerDecoration=t.maps.MarkerDecoration,e.Point=t.maps.Point,v(e),navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){e.showPosition(t)},function(t){e.showPositionError(t)},{enableHighAccuracy:!1,timeout:10,maximumAge:864e5})}else alert("浏览器不支持定位");e.rangeList&&e.rangeList.length>0&&e.getAreaInfo()});case 5:case"end":return t.stop()}},t,e)}))()},methods:{showPosition:function(e){console.log(e,"获取到浏览器位置"),this.locationC={latitude:e.coords.latitude,longitude:e.coords.longitude};var t=this;qq.maps.convertor.translate(new qq.maps.LatLng(latitude,longitude),1,function(e){var a=e[0];t.map.setCenter(a),t.marker.setPosition(a)})},showPositionError:function(e){console.log(e,"error");var t=this;new qq.maps.CityService({complete:function(e){t.locationC={latitude:e.detail.latLng.lat,longitude:e.detail.latLng.lng},t.map.setCenter(e.detail.latLng),t.marker.setPosition(e.detail.latLng)}}).searchLocalCity()},AddPolygon:function(e,t,a){this.color=e||this.color;var r=new qq.maps.Polygon({clickable:!0,cursor:"crosshair",editable:!0,fillColor:new qq.maps.Color(this.color[0],this.color[1],this.color[2],.5),map:this.map,path:a||this.path,strokeColor:new qq.maps.Color(this.color[0],this.color[1],this.color[2]),strokeDashStyle:"solid",strokeWeight:4,visible:!0,zIndex:1e3});this.map.setCenter(new qq.maps.LatLng(this.locationC.latitude,this.locationC.longitude)),this.polygonList.push(r),this.objParams.paramsFormList.push({name:t||"",Color:this.color})},addDelivery:function(){var e=this;return u()(l.a.mark(function t(){var a,r,o,n,s;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.form.latitude||!e.form.longitude){t.next=10;break}if(a=Number(e.form.longitude),r=Number(e.form.latitude),!(a<-180||a>180)){t.next=6;break}return e.$message("经度输入有误，经度范围：-180~180"),t.abrupt("return");case 6:if(!(r<-90||r>90)){t.next=9;break}return e.$message("纬度输入有误，纬度范围：-90~90"),t.abrupt("return");case 9:i()(e.locationC,e.form);case 10:if(e.locationC.latitude&&e.locationC.longitude){t.next=13;break}return e.$message("获取定位失败，请填写经纬度"),t.abrupt("return");case 13:return t.next=15,g(e);case 15:return o=t.sent,n=o.color,s=o.path,e.color=n,e.path=s,t.next=22,e.AddPolygon();case 22:case"end":return t.stop()}},t,e)}))()},CheckTicketFun:function(){var e=this;this.objParams.paramsFormList.length>0&&this.polygonList.forEach(function(t,a){var r="";t.getPath().elems.forEach(function(e,t){t>0&&(r+=";"),r+=e.lng+","+e.lat}),e.objParams.paramsFormList[a].coordinate=r}),this.$refs.formArea.validate(function(t){if(!t)return e.$message("请输入范围名称"),!1;var a=JSON.parse(o()(e.objParams.paramsFormList));a.forEach(function(e){delete e.Color}),console.log(a,"paramsFormList"),e.$emit("CheckTicketFun",a)})},delIcon:function(e){this.polygonList[e].setMap(null),this.polygonList.splice(e,1),this.objParams.paramsFormList.splice(e,1)},getAreaInfo:function(){var e=this;return u()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.rangeList.forEach(function(){var t=u()(l.a.mark(function t(a,r){var o,n,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=[],a.coordinate.split(";").forEach(function(e){var t=e.split(",");o.push(new qq.maps.LatLng(parseFloat(t[1]),parseFloat(t[0])))}),n=g(e,!0),i=n.color,n.path,setTimeout(function(){e.AddPolygon(i,a.name,o)},1e3);case 5:case"end":return t.stop()}},t,e)}));return function(e,a){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t,e)}))()},getStoreList:function(){var e=this;return u()(l.a.mark(function t(){var a,r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(f.a)({Action:"GetShopList"},"MShopOpera");case 3:a=t.sent,r=a.Data,e.storeList=r.ShopInfoList,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),e.$message.error(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()}}};function g(e,t){var a=[];return a.push(Math.floor(256*Math.random())),a.push(Math.floor(256*Math.random())),a.push(Math.floor(256*Math.random())),t?{color:a}:{color:a,path:[new qq.maps.LatLng(parseFloat(e.locationC.latitude)+.01,parseFloat(e.locationC.longitude)-.015),new qq.maps.LatLng(parseFloat(e.locationC.latitude)+.01,parseFloat(e.locationC.longitude)+.015),new qq.maps.LatLng(parseFloat(e.locationC.latitude)-.01,parseFloat(e.locationC.longitude)+.015),new qq.maps.LatLng(parseFloat(e.locationC.latitude)-.01,parseFloat(e.locationC.longitude)-.015)]}}function v(e){new qq.maps.InfoWindow({map:e.map});for(var t=function(t){r=new e.LatLng(e.storeList[t].Latitude,e.storeList[t].Longitude),new e.MarkerDecoration(t,new e.Point(0,-5)),o=new e.Marker({position:r,map:e.map});var a=new qq.maps.Label({position:r,map:e.map,content:e.storeList[t].Name+"("+e.storeList[t].Address+")"});e.Event.addListener(o,"map_changed",function(e){e.target.isClustered?a.setVisible(!1):a.setVisible(!0)}),e.markers.push(o)},a=0;a<e.storeList.length;a++){var r,o;t(a)}e.markerClusterer=new e.MarkerCluster({map:e.map,minimumClusterSize:2,markers:e.markers,zoomOnClick:!0,gridSize:30,averageCenter:!0,maxZoom:18})}var L={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"area_app_style"},[t("div",{staticStyle:{"margin-bottom":"30px"}},[t("el-form",{ref:"formArea",staticStyle:{"margin-top":"10px"},attrs:{model:this.objParams,"label-width":"80px",inline:!0}})],1),this._v(" "),this.isStore?this._e():t("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[t("el-button",{staticStyle:{margin:"20px"},attrs:{type:"primary",loading:this.loadingBtn},on:{click:this.CheckTicketFun}},[this._v("提 交")])],1)])},staticRenderFns:[]};var b=a("VU/8")(h,L,!1,function(e){a("2JAD")},"data-v-7203d92e",null);t.a=b.exports},Cewj:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("woOf"),o=a.n(r),n=a("Xxa5"),i=a.n(n),s=a("exGp"),l=a.n(s),c=a("nkvz"),u=a("T+sA"),p=a("Ua8o"),m=a("AoqP"),d={name:"",data:function(){return{list:[],value:""}},components:{},created:function(){0===this.list.length&&this.getAreaList()},methods:{getAreaList:function(){var e=this;return l()(i.a.mark(function t(){var a,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(u.a)({Action:"GetAreaList"},"MShopOpera");case 3:a=t.sent,r=a.Data,e.list=r.ProdCateList,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),e.$message.error(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()},changeType:function(e){this.$emit("changeType",e)}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changeType},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.list,function(e){return a("el-option",{key:e.SID,attrs:{label:e.Name,value:e.SID}})}),1)],1)},staticRenderFns:[]};var h=a("VU/8")(d,f,!1,function(e){a("KIA8")},"data-v-e2073890",null).exports,g={name:"edit",components:{imgLoad:c.a,areaMy:m.a,storeAreaList:h},data:function(){return{form:{Img:[]},dialogTableVisible:!1,gridData:[],Name:"",currentRow:null,rules:{Name:[{required:!0,message:"请填写门店名称",trigger:"blur"}]},fileListUp:[],btnLoading:!1,checkedType:!0}},created:function(){this.$route.meta.label="添加门店",this.$route.query.sid&&this.getInfo()},methods:{getMendian:function(){var e=this;return l()(i.a.mark(function t(){var a,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(u.a)({Action:"GetEntShopList",Name:e.Name},"MShopOpera");case 3:a=t.sent,r=a.Data,e.gridData=r.ShopInfoList,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}},t,e,[[0,8]])}))()},getInfo:function(){var e=this;return l()(i.a.mark(function t(){var a,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(u.a)({Action:"GetShop",SID:e.$route.query.sid},"MShopOpera");case 3:a=t.sent,r=a.Data,e.form=r.ShopInfo,e.fileListUp=e.form.Img?[{url:"../"+e.form.Img}]:[],t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),e.$message.error(t.t0);case 12:case"end":return t.stop()}},t,e,[[0,9]])}))()},upLoadImg:function(e){for(var t=[],a=e,r=0;r<a.length;r++)t.push(a[r].url);this.form.Img=t.join(",")},preserveFun:function(){var e,t=this;this.$refs.form.validate((e=l()(i.a.mark(function e(a){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=20;break}return t.form.Img&&(t.form.Img=Object(p.f)(t.form,"Img")),t.$route.query.sid&&(t.form.ShopNo=""),r={Action:"SetShop"},o()(r,t.form),t.btnLoading=!0,e.prev=6,e.next=9,Object(u.a)(r,"MShopOpera");case 9:t.$message.success("提交成功"),t.$router.push("/weChat/manager/storeSet/index"),t.btnLoading=!1,e.next=18;break;case 14:e.prev=14,e.t0=e.catch(6),t.btnLoading=!1,t.$message.error(e.t0);case 18:e.next=20;break;case 20:case"end":return e.stop()}},e,t,[[6,14]])})),function(t){return e.apply(this,arguments)}))},dragendArea:function(e){this.$set(this.form,"Longitude",e.longitude),this.$set(this.form,"Latitude",e.latitude)},selectArea:function(){this.$refs.dialogAreaRef.dialogVisible=!0},changeType:function(e){this.form.AreaSID=e},selecStore:function(){this.dialogTableVisible=!0,this.getMendian()},searchName:function(){this.getMendian()},handleCurrentChange:function(e){this.currentRow=e},sure:function(){this.form.ShopNo=this.currentRow.ShopNo,this.form.Name=this.currentRow.ShopName,this.form.Tel=this.currentRow.Mobile,this.form.Address=this.currentRow.Address,this.form.Longitude=this.currentRow.Location.split(",")[0],this.form.Latitude=this.currentRow.Location.split(",")[1],this.dialogTableVisible=!1}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"storeSet"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[a("el-form-item",{attrs:{label:"门店",prop:"ShopNo"}},[a("el-input",{attrs:{readonly:!0,placeholder:"请选择门店"},model:{value:e.form.ShopNo,callback:function(t){e.$set(e.form,"ShopNo",t)},expression:"form.ShopNo"}}),e._v(" "),e.$route.query.sid?e._e():a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.selecStore(null)}}},[e._v("选择门店")])],1),e._v(" "),a("el-form-item",{attrs:{label:"门店区域：",prop:"AreaSID"}},[a("storeAreaList",{on:{changeType:e.changeType}})],1),e._v(" "),a("el-form-item",{attrs:{label:"门店名称：",prop:"Name"}},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.form.Name,callback:function(t){e.$set(e.form,"Name",t)},expression:"form.Name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"门店地址：",prop:"Address"}},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.form.Address,callback:function(t){e.$set(e.form,"Address",t)},expression:"form.Address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"门店电话：",prop:"Tel"}},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.form.Tel,callback:function(t){e.$set(e.form,"Tel",t)},expression:"form.Tel"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"经度：",prop:"Longitude"}},[a("el-input",{attrs:{readonly:!0,placeholder:"请输入内容"},model:{value:e.form.Longitude,callback:function(t){e.$set(e.form,"Longitude",t)},expression:"form.Longitude"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"纬度：",prop:"Latitude"}},[a("el-input",{attrs:{readonly:!0,placeholder:"请输入内容"},model:{value:e.form.Latitude,callback:function(t){e.$set(e.form,"Latitude",t)},expression:"form.Latitude"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"门店图片："}},[a("imgLoad",{ref:"imgLoad",staticStyle:{"margin-top":"10px"},attrs:{fileListUp:e.fileListUp,folder:"ShopImg"},on:{upLoadImgs:e.upLoadImg}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"门店列表",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("div",{staticStyle:{"margin-bottom":"20px","text-align":"center"}},[a("span",[e._v("名称搜索")]),e._v(" "),a("el-input",{staticStyle:{"margin-right":"10px",width:"180px"},attrs:{placeholder:"请输入"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchName(t)}},model:{value:e.Name,callback:function(t){e.Name=t},expression:"Name"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.searchName}},[e._v("搜索")])],1),e._v(" "),a("el-table",{attrs:{data:e.gridData,"highlight-current-row":""},on:{"current-change":e.handleCurrentChange}},[a("el-table-column",{attrs:{prop:"ShopName",label:"名称",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ShopNo",label:"门店编号",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"Mobile",label:"电话"}}),e._v(" "),a("el-table-column",{attrs:{prop:"Address",label:"地址"}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.sure}},[e._v("确 定")])],1)],1),e._v(" "),a("div",{staticClass:"preserveStyle"},[a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",loading:e.btnLoading},on:{click:e.preserveFun}},[e._v("提交")])],1)],1)},staticRenderFns:[]};var L=a("VU/8")(g,v,!1,function(e){a("dThh")},"data-v-6e77f672",null);t.default=L.exports},KIA8:function(e,t){},dThh:function(e,t){}});
//# sourceMappingURL=8.3c39a372c3263c28ced4.js.map
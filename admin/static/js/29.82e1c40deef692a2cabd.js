webpackJsonp([29],{"3gGL":function(e,t){},"5W19":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("mvHQ"),a=r.n(o),s=r("Xxa5"),l=r.n(s),i=r("//Fk"),n=r.n(i),c=r("exGp"),u=r.n(c),p=(r("Ua8o"),r("R2SV")),d=r("T+sA"),m=r("2uFj"),v=r("ysSL"),h=r("7Zmj"),f=r("LxfK"),g=r("nkvz"),S=r("Cn51"),y=r("QvYb"),b=r("M4fF"),k=r.n(b),F=(r("G9QH"),r("V19L")),_=r("lbHh"),x=r.n(_),w={name:"",components:{goodType:v.a,Goods:h.a,imgLoad:g.a,ueditor1:S.a,mallGoods:f.a,QRCode:F.a},data:function(){var e=this;return{ruleForm:{Type:"1",Start:"1",SalePrice:0,MaxBuyCnt:0,ProdList:[]},multipleL:"",activityDate:[],activeUrlGood:m.d,AppNoMy:x.a.get("AppNo"),rules:{ProdNo:[y.d(this,"请选择活动商品")],Name:[y.b(this,"请填写活动名称")],StoreQty:[y.g(this)],ShopInfo:[y.f(this)],PayType:[{required:!0,message:"请选择支付方式",trigger:"change"}],SalePrice:[{required:!0,message:"请填写秒杀售价",trigger:"blur"}],activityDate:[{required:!0,message:"请选择活动日期",trigger:"change",validator:function(t,r,o){e.activityDate?o():o(new Error("请选择活动日期"))}}]},loading:!1,goodsShow:!1,goodsNormsIndex:0,fileListUpMain:[],fileListUpList:[],integralStateList:p.f,showCheckTicket:!1,checkClick:[],checkList:[],disabledTakeout:!1,disabledLogistics:!0,FeaturesShow:!0,ImportantNotesShow:!0,activeTypeNorms:p.a,codeUrl:"",prodListArr:[]}},created:function(){this.codeUrl=this.$route.query.SID,this.getInfo()},methods:{getInfo:function(){var e=this;return u()(l.a.mark(function t(){var r,o,a,s,i,c;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,r=e.$route.query.SID?Object(d.a)({Action:"GetPromotion",SID:e.$route.query.SID},"MPromotionOpera"):[],t.next=5,n.a.all([r]);case 5:o=t.sent,e.loading=!1,e.$route.query.SID&&(e.ruleForm=o[0].Data.Promotion,e.ruleForm.ProdList=o[0].Data.ItemList,e.prodListArr=o[0].Data.ItemList,e.activityDate=[e.ruleForm.StartDate,e.ruleForm.EndDate],e.ruleForm.MaxBuyCnt=e.ruleForm.MaxBuyCnt?Number(e.ruleForm.MaxBuyCnt):0,"1"===e.ruleForm.SpecType&&(a=e.ruleForm.ProdList[0],e.ruleForm.SalePrice=a.SalePrice,e.ruleForm.StoreQty=a.StoreQty,s=Number(a.StoreQty)-Number(a.SurplusQty),e.ruleForm.SurplusQty=s),i=$.base64.atob(e.ruleForm.Features,"utf8"),c=$.base64.atob(e.ruleForm.ImportantNotes,"utf8"),i=i.replace(/src="Files/g,'src="../Files'),c=c.replace(/src="Files/g,'src="../Files'),setTimeout(function(){e.$refs.Features.setUEContent(i),e.$refs.ImportantNotes.setUEContent(c)},300)),t.next=12;break;case 10:t.prev=10,t.t0=t.catch(0);case 12:case"end":return t.stop()}},t,e,[[0,10]])}))()},changeNorms:function(){},selectGoods:function(e){this.prodListArr=this.prodListArr,this.goodsShow=!0,this.goodsNormsIndex=e},changeDig:function(e){this.goodsShow=e},sureGood:function(e){this.goodsShow=!1,this.ruleForm.ProdList=e},upLoadImgsMain:function(e){e.length>0?this.ruleForm.Img=e[0].url:this.ruleForm.Img=""},upLoadImgsList:function(e){var t=[];e.forEach(function(e){t.push(e.url)}),this.ruleForm.ImgList=t.join(",")},CheckTicketFun:function(){var e=this,t=[];this.checkClick.forEach(function(r){t.push(k.a.find(e.checkList,{SID:r}))});var r=function(e,t,r){var o=e,a=[],s=[];o.length>0&&o.forEach(function(e){a.push(e[t]),s.push(e[r])});return{nameArr:a,idArr:s}}(t,"Name","SID"),o=r.nameArr;r.idArr;this.ruleForm.PickShopName=o.join(","),this.ruleForm.ShopInfo=this.checkClick.join(","),this.showCheckTicket=!1,this.checkClick=[]},beforeClose:function(e){e()},changeCheckbox:function(e){e.indexOf("3")>-1?this.disabledTakeout=!0:e.indexOf("2")>-1?this.disabledLogistics=!0:(this.disabledTakeout=!1,this.disabledLogistics=!1)},cancelFun:function(){this.$router.push("/weChat/manager/activity/goodSetting")},preserveFun:function(){var e,t=this,r=[];this.ruleForm.ProdList.forEach(function(e){r.push({Name:e.Name,StoreQty:e.StoreQty,OldPrice:e.OldPrice,SalePrice:e.SalePrice,Stock:e.Stock,SurplusQty:e.SurplusQty,ProdSID:e.ProdSID,SpecSID:e.SpecSID,ProdNo:e.ProdNo,SpecType:e.SpecType})}),this.ruleForm.ProdList=r;for(var o=0;o<this.ruleForm.ProdList.length;o++)if(void 0===this.ruleForm.ProdList[o].SalePrice)return this.$message.error("请填写活动价格"),!1;this.$refs.ruleForm.validate((e=u()(l.a.mark(function e(r){var o,s,i,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}return e.abrupt("return",!1);case 4:return e.prev=4,o=k.a.cloneDeep(t.ruleForm),s=(s=t.$refs.Features.getUEContent()).replace(/src="\.\.\/Files/g,'src="Files'),o.Features=$.base64.btoa(s,"utf8"),i=(i=t.$refs.ImportantNotes.getUEContent()).replace(/src="\.\.\/Files/g,'src="Files'),o.ImportantNotes=$.base64.btoa(i,"utf8"),t.activityDate&&(o.StartDate=t.activityDate[0],o.EndDate=t.activityDate[1]),o.ProdList=a()(o.ProdList),o.Action="SetPromotionInfo",e.next=17,Object(d.a)(o,"MPromotionOpera");case 17:n=e.sent,t.$message.success("操作成功,可用二维码浏览"),setTimeout(function(){t.$router.push("/weChat/manager/activity/goodSetting")},300),t.codeUrl=n.Message,e.next=26;break;case 23:e.prev=23,e.t0=e.catch(4),t.$message.error(e.t0);case 26:case"end":return e.stop()}},e,t,[[4,23]])})),function(t){return e.apply(this,arguments)}))},setInputDec:function(e,t){e&&(this.ruleForm[t]=e.toString().split(".")[0])}},watch:{}};var C={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"addEditActive"},[e._v("\n  基本信息\n  "),r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"150px"}},[r("el-form-item",{key:6,attrs:{label:"活动类型"}},[r("el-select",{attrs:{placeholder:"请选择",disabled:!!this.$route.query.SID},on:{change:e.changeNorms},model:{value:e.ruleForm.Type,callback:function(t){e.$set(e.ruleForm,"Type",t)},expression:"ruleForm.Type"}},e._l(e.activeTypeNorms,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{key:1,attrs:{label:"商品选择"}},[r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.selectGoods(null)}}},[e._v("选择商品")]),e._v(" "),r("el-table",{ref:"ProdNoList",staticStyle:{"margin-top":"10px",width:"700px"},attrs:{data:e.ruleForm.ProdList}},[r("el-table-column",{attrs:{prop:"Name",label:"商品名称",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"ProdNo",label:"商品编号",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"Stock",label:"商品库存",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"商品原价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥"+e._s(t.row.OldPrice))]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"SalePrice",label:"活动价格",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[r("input",{directives:[{name:"model",rawName:"v-model",value:o.SalePrice,expression:"row.SalePrice"}],staticClass:"number",staticStyle:{width:"100%","text-align":"center",border:"1px solid #c1c1c1"},attrs:{maxlength:"10",type:"text",oninput:"value=value.replace(/[^\\d.]/g, '').replace(/^(\\-)*(\\d+)\\.(\\d\\d).*$/,'$1$2.$3')"},domProps:{value:o.SalePrice},on:{input:function(t){t.target.composing||e.$set(o,"SalePrice",t.target.value)}}})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"StoreQty",label:"活动数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[r("input",{directives:[{name:"model",rawName:"v-model",value:o.StoreQty,expression:"row.StoreQty"}],staticClass:"number",staticStyle:{width:"100%","text-align":"center",border:"1px solid #c1c1c1"},attrs:{oninput:"value=value.replace(/[^\\d]/g, '').replace(/^0{1,}/g,'')",maxlength:"10",type:"text"},domProps:{value:o.StoreQty},on:{input:function(t){t.target.composing||e.$set(o,"StoreQty",t.target.value)}}})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"SurplusQty",label:"剩余数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[r("input",{directives:[{name:"model",rawName:"v-model",value:o.SurplusQty,expression:"row.SurplusQty"}],staticClass:"number",staticStyle:{width:"100%","text-align":"center",border:"1px solid #c1c1c1"},attrs:{oninput:"value=value.replace(/[^\\d]/g, '').replace(/^0{1,}/g,'')",maxlength:"10",type:"text"},domProps:{value:o.SurplusQty},on:{input:function(t){t.target.composing||e.$set(o,"SurplusQty",t.target.value)}}})]}}])})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"活动名称",prop:"Name"}},[r("el-input",{attrs:{placeholder:"请填写活动名称"},model:{value:e.ruleForm.Name,callback:function(t){e.$set(e.ruleForm,"Name",t)},expression:"ruleForm.Name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"活动时间",prop:"activityDate"}},[r("el-date-picker",{staticStyle:{width:"380px"},attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.activityDate,callback:function(t){e.activityDate=t},expression:"activityDate"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"最大购买数量",prop:"MaxBuyCnt"}},[r("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.ruleForm.MaxBuyCnt,callback:function(t){e.$set(e.ruleForm,"MaxBuyCnt",t)},expression:"ruleForm.MaxBuyCnt"}}),e._v(" "),r("span",{staticClass:"Spancolor"},[e._v("(不填或者0的时候，不限制购买数量)")])],1),e._v(" "),r("el-form-item",{attrs:{label:"状态",prop:"Start"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.Start,callback:function(t){e.$set(e.ruleForm,"Start",t)},expression:"ruleForm.Start"}},[r("el-option",{attrs:{label:"启动",value:"1"}},[e._v("启动")]),e._v(" "),r("el-option",{attrs:{label:"关闭",value:"0"}},[e._v("关闭")])],1)],1),e._v(" "),r("el-form-item",{staticClass:"FeaturesStyle",attrs:{label:"产品特色",prop:"Features"}},[!1===e.FeaturesShow?r("el-button",{attrs:{type:"text"},on:{click:function(t){e.FeaturesShow=!0}}},[e._v("+编辑")]):e._e(),e._v(" "),e.FeaturesShow?r("ueditor1",{ref:"Features"}):e._e(),e._v(" "),!0===e.FeaturesShow?r("el-button",{attrs:{type:"text"},on:{click:function(t){e.FeaturesShow=!1}}},[e._v("隐藏")]):e._e()],1),e._v(" "),r("el-form-item",{staticClass:"FeaturesStyle",attrs:{label:"重要提示",prop:"ImportantNotes"}},[!1===e.ImportantNotesShow?r("el-button",{attrs:{type:"text"},on:{click:function(t){e.ImportantNotesShow=!0}}},[e._v("+编辑")]):e._e(),e._v(" "),e.ImportantNotesShow?r("ueditor1",{ref:"ImportantNotes"}):e._e(),e._v(" "),!0===e.ImportantNotesShow?r("el-button",{attrs:{type:"text"},on:{click:function(t){e.ImportantNotesShow=!1}}},[e._v("隐藏")]):e._e()],1)],1),e._v(" "),r("mall-goods",{attrs:{goodsShow:e.goodsShow,prodList:e.prodListArr},on:{changeDig:e.changeDig,sureGood:e.sureGood}}),e._v(" "),r("el-dialog",{staticClass:"areaTree TicketDialog",attrs:{title:"选择门店",width:"600px","before-close":e.beforeClose,visible:e.showCheckTicket},on:{"update:visible":function(t){e.showCheckTicket=t}}},[r("div",{staticClass:"addScroll"},[r("el-checkbox-group",{model:{value:e.checkClick,callback:function(t){e.checkClick=t},expression:"checkClick"}},e._l(e.checkList,function(t){return r("el-checkbox",{key:t.SID,attrs:{label:t.SID}},[e._v(e._s(t.Name))])}),1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showCheckTicket=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.CheckTicketFun}},[e._v("确 定")])],1)]),e._v(" "),r("div",{staticClass:"preserveStyle"},[r("el-button",{on:{click:e.cancelFun}},[e._v("取消")]),e._v(" "),r("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:e.preserveFun}},[e._v("保存")])],1),e._v(" "),e.codeUrl?r("div",{staticClass:"active-code-style"},[r("div",{staticClass:"active-code-style-title"},[e._v("手机微信扫码浏览")]),e._v(" "),r("QRCode",{attrs:{newWidth:200,newText:e.activeUrlGood+e.codeUrl+"?AppNo="+e.AppNoMy+"&seckill=true&isBrowse=true"}})],1):e._e()],1)},staticRenderFns:[]};var N=r("VU/8")(w,C,!1,function(e){r("3gGL")},null,null);t.default=N.exports}});
//# sourceMappingURL=29.82e1c40deef692a2cabd.js.map